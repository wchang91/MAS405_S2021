---
output:
  pdf_document: default
  html_document: default
  word_document: default
---





---
title: "Officials in NHL Games with Prolific Player Scoring"
output:
  pdf_document:
    includes:
      in_header: "preamble.tex"
    toc: yes
    toc_depth: '3'
    geometry: left=10mm, right=10mm, top=25mm, bottom=25mm
  html_document:
    theme: paper
    toc: yes
    toc_depth: 3
    toc_float: yes
---



<style type="text/css">.main-container {  max-width: 2800px;  margin-left: auto;  margin-right: auto;}</style>





```{r datetime, echo=FALSE, eval=TRUE}
## Sys.setlocale("LC_ALL")
xtoday <-  format(Sys.time(), "%Y-%m-%d")
#cat("Date last run:", xtoday)
#cat("\n")
#cat("Stats MAS405 Spring 2021")
#cat("\n")
## cat("Section #")
options(width=200, xtable.comment = FALSE)
###### we can use this to get current build output
###### useful when deciding how to format tables
```

`r xtoday`

Stats MAS405 Spring 2021

your names







```{r TOP, echo=FALSE, message=FALSE, eval=TRUE, results='hide'}
#### note ``` (3 backticks)
##### R code goes in here.  Set code chunk environment options above
projpath <- getwd()
if(!exists("xdbsock")) {
    xdbsock <- ""
    cat("\n", "Parameter 'xdbsock' not found, setting to empty string for general usage", "\n")
}
library(RMySQL)
library(knitr)
library(xtable)
### opts_knit$get("rmarkdown.pandoc.to")
drv <- dbDriver("MySQL")
xdbuser <- Sys.getenv("MAS405_AWS_DZES_DB_RO_USER") ### 
xpw     <- Sys.getenv("MAS405_AWS_DZES_DB_RO_PW") ### 
xdbname <- Sys.getenv("MAS405_AWS_DZES_DB_RO_DBNAME") ### 
xdbhost <- Sys.getenv("MAS405_AWS_DZES_DB_RO_HOST") ###
xdbport <- as.integer( Sys.getenv("MAS405_AWS_DZES_DB_RO_PORT") )
############# db1
#xdbuser <- Sys.getenv("MAS405_AWS_MY_DB_ADMIN_USER")
#xpw <- Sys.getenv("MAS405_AWS_MY_DB_ADMIN_PW")
#xdbname <- Sys.getenv("MAS405_AWS_MY_DB_ADMIN_DBNAME")
#xdbhost <- Sys.getenv("MAS405_AWS_MY_DB_ADMIN_HOST")
#xdbport <- as.integer( Sys.getenv("MAS405_AWS_MY_DB_ADMIN_PORT") )
con <- dbConnect(drv, user=xdbuser, password=xpw, dbname=xdbname, host=xdbhost, port=xdbport, unix.sock=xdbsock)
```


```{r runQueryDate, echo=FALSE, eval=TRUE, results='hide'}
##### get min and max date
qstr <- "SELECT MIN(date), MAX(date) FROM nhl_playersDate_1"
xx <- dbGetQuery(con, qstr)
xx
xMinDataDate <- xx[1, 1]
xMaxDataDate <- xx[1, 2]
xminDD <- format( strptime(xMinDataDate, "%Y%m%d"), "%Y-%m-%d")
xmaxDD <- format( strptime(xMaxDataDate, "%Y%m%d"), "%Y-%m-%d")
xpntsCO <- 3
```


## Introduction

<!--
%In the NBA, are some officials more likely than others to have officiated a game in which a player had proliffic scoring?
-->
In the NHL, are some officials more likely than others to have officiated a game with a prolific individual player performance?
Utilizing regular season NHL game and player data spanning `r xminDD` to `r xmaxDD`, we produce frequencies of officials in games where a player scored more than `r xpntsCO+1` or more goals.


```{r runMainQuery, echo=FALSE, eval=TRUE, results='hide', warning=FALSE}
qstr = "SELECT ngd.date, ngd.VT, ngd.HT , ngd.officials, npd.firstName , npd.lastName , npd.goals 
        FROM nhl_gameDate_1 ngd 
        JOIN nhl_playersDate_1 npd ON npd.gameID = ngd.gameID AND npd.goals > 3"
results = dbGetQuery(con, qstr)
results

results[,"VT"] = gsub("\xe9","e", results[,"VT"])
results[,"HT"] = gsub("\xe9","e", results[,"HT"])
results

#kable(results)  # I dont know why but Kable does not like one of the characters in the results
```


## Results

Table 1 shows game information for all games in our data where a player (name) scored more than `r xpntsCO` points.


```{r runQuery1result, echo=FALSE, eval=TRUE, results='asis', table.width=20}
### kable(results, format="html", table.attr = "style='width:40% ;'")
##### we can use opts_knit$get("rmarkdown.pandoc.to") to determine whether we'd 
##### rather use kable or xtable to render a table 
if( opts_knit$get("rmarkdown.pandoc.to") %in% "html" ) {
  kable(results, format="html", table.attr = "style='width:100% ;'")
}
if( opts_knit$get("rmarkdown.pandoc.to") %in% "latex" ) {
  
  xcaption <- "NBA games in data where player scored more than 55 points."
  
  #xxtb <- kable(results, format="latex", caption=xcaption)
  #kable_styling(xxtb, latex_options=c("scale_down", "HOLD_position", "striped") )
  
  x.big <- suppressWarnings(xtable(results, label='tabbig'))
  caption(x.big) <- xcaption
  ## xx <- suppressWarnings(print(x.big, tabular.environment='longtable', include.rownames=FALSE, print.results=FALSE))
  xx <- 
    suppressWarnings(
    print(
      x.big, 
      tabular.environment='tabular', 
      include.rownames=FALSE, 
      print.results=FALSE
      )
    )
  
  #print(x.big, tabular.environment='longtable',
  #      floating=FALSE,include.rownames=FALSE, 
  #      hline.after = c(-1,nrow(x.big)),
  #      add.to.row = list(pos = list(0),
  #      command = "\\hline \\endhead "), file = "output.tex")
  yy <- strsplit(xx, "\n")[[1]]
  
  yy <- c(yy[1], "\\tiny", yy[2:length(yy)])
  
  writeLines(yy, "output.tex")
  
}
```
\input{output.tex}


\newpage

```{r  echo=FALSE, results = "hide"}
officials_list <- gsub("^\\s*|\\s*$", "", (unlist(strsplit(results[ , "officials"], ";"))))
officials_df <- as.data.frame(table(officials_list))
officials_df <- officials_df[ order(officials_df[ , "Freq"], decreasing=TRUE), ]
officials_df
```



```{r runTableOfficials, echo=FALSE, eval=TRUE, results='asis'}



```


